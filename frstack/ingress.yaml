# Ingress for our components
# Note that the nginx ingress path /foo matches /foo, /foo/bar etc.
# To get the equivalent on GCE ingress you need two rules /foo and /foo/*
# Nginx seems OK to ignore the extra *
#
# NOTE: The openidm ingress does not work right now on GCE
# The default health checker requires a 200 response on the / URL of the app
# but openidm is not configured with anything on / (selfservice is moved to /idmselfservice)
# The manual workaround is to edit the GCE compute health check and change the
# Test URL to /idmselfservice
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: openam
spec:
  rules:
  - host: openam.example.com
    http:
      paths:
      - path: /openam
        backend:
          serviceName: openam
          servicePort: 80
      - path: /openam/*
        backend:
          serviceName: openam
          servicePort: 80
      - path: /apache/*
        backend:
          serviceName: apache-svc
          servicePort: 80
      - path: /apache
        backend:
          serviceName: apache-svc
          servicePort: 80
      - path: /openidm/*
        backend:
          serviceName: openidm
          servicePort: 80
      - path: /openidm
        backend:
          serviceName: openidm
          servicePort: 80
      - path: /admin/*
        backend:
          serviceName: openidm
          servicePort: 80
      - path: /admin
        backend:
          serviceName: openidm
          servicePort: 80
      - path: /idmselfservice/*
        backend:
          serviceName: openidm
          servicePort: 80
      - path: /idmselfservice
        backend:
          serviceName: openidm
          servicePort: 80
      - path: /ig
        backend:
          serviceName: openig
          servicePort: 80
      - path: /ig/*
        backend:
          serviceName: openig
          servicePort: 80
